<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天氣預報</title>
    <link rel="stylesheet" href="./_css/bootstrap.css">
    <link rel="apple-touch-icon" sizes="180x180" href="./favicon_io/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./favicon_io/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./favicon_io/favicon-16x16.png">
    <link rel="stylesheet" href="./generalstyle.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
    <script src="./_js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>


    <style>
        table {
            /* table-layout: fixed; */
            /* width: 100%; */
            text-align: center;
            position: relative;
            border-collapse: collapse;
        }

        thead {
            font-size: 20px;
        }

        table,
        tr,
        td {
            border: 2px solid black;
            padding: 8px;
            width: max-content;
            height: 50px;
        }


        td>img {
            width: 80px;
        }

        select {
            width: 150px;
            height: 36px;
            cursor: pointer;
            margin: 0 10px;
        }

        form>span {
            font-size: 20px;
        }

        .t1 {
            font-size: 18px;
            width: 100px;
            background-color: rgb(112, 205, 238);
            position: sticky;
            left: 0;
            /* border-right: 2px solid black; */
            /* z-index: 1; */
        }

        .tablesticky {
            width: 100%;
            height: fit-content;
            overflow: auto;
            border: 1px solid black;
        }
    </style>
</head>

<body>
    <!-- header -->
    <header style="position: relative;">
        <img src="./img/4-2.JPG" alt="" style="width: 100%; opacity:0.8; height: 320px; object-fit: cover;">
        <h1 id="header"></h1>
    </header>
    <script>
        setTimeout(header, 1200)
        function header() {
            document.getElementById("header").innerHTML = "天氣預報"
        }
    </script>

    <!-- nav -->
    <div style=" width:100%; " class="nav1">
        <div class="container">
            <nav class="d-flex justify-content-center py-3">
                <ul class="nav nav-pills">
                    <li class="nav-item"><a href="./Home.html" class="nav-link " aria-current="page"
                            style="color:#b7e792; font-size:20px">Hello Mountain</a></li>
                    <li class="nav-item">
                        <a class="nav-link dropdown-toggle show" href="#" data-bs-toggle="dropdown"
                            aria-expanded="true">熱門百岳路線</a>
                            <ul class="dropdown-menu " data-bs-popper="static">
                                <li class="sub">北部</li>
                                <li><a class="dropdown-item" href="./DaBa_08.html">大小霸尖山</a></li>
                                <li><a class="dropdown-item" href="./NanHu_07.html">南湖群峰</a></li>
                                <li><a class="dropdown-item" href="./MtSylvia_01.html">雪山主東</a></li>
                                <li class="sub">中部</li>
                                <li><a class="dropdown-item" href="./HeHuan_02.html">合歡群峰</a></li>
                                <li><a class="dropdown-item" href="./QilaiNanhua_03.html">奇萊南華</a></li>
                                <li class="sub">南部</li>
                                <li><a class="dropdown-item" href="./MtJade_05.html">玉山主峰</a></li>
                                <li><a class="dropdown-item" href="./NanHeng_09.html">南橫三星</a></li>
                                <li><a class="dropdown-item" href="./BaDaWu_06.html">北大武山</a></li>
                                <li><a class="dropdown-item" href="./JiaMing_04.html">嘉明湖步道</a></li>
                            </ul>
                    </li>
                    <li class="nav-item"><a href="./Allroute.html" class="nav-link">路線一覽</a></li>
                    <li class="nav-item"><a href="./Weather.html" class="nav-link active">天氣預報</a></li>
                    <li class="nav-item"><a href="./Equipment.html" class="nav-link ">裝備清單</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle show" href="#" data-bs-toggle="dropdown"
                            aria-expanded="true">官方網站入口</a>
                        <ul class="dropdown-menu " data-bs-popper="static">
                            <li><a class="dropdown-item" target="_blank" href="https://www.spnp.gov.tw/">雪霸國家公園</a></li>
                            <li><a class="dropdown-item" target="_blank" href="https://www.taroko.gov.tw/">太魯閣國家公園</a>
                            </li>
                            <li><a class="dropdown-item" target="_blank" href="https://www.ysnp.gov.tw/">玉山國家公園</a></li>
                            <li><a class="dropdown-item" target="_blank"
                                    href="https://recreation.forest.gov.tw/">台灣山林悠遊網</a></li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- 留白排版用 -->
    <div style="height: 50px;"></div>

    <!-- content  -->

    <div class="container d-flex justify-content-center">
        <div class="row" style="width: 85%">
            <div class="col-md-12">

                <form>
                    <span>請選擇 &nbsp;:</span>
                    <select name="" id="se">
                        <optgroup label="雪山主東">
                            <option value="102" selected>雪山主峰</option>
                            <option value="5">雪山東峰</option>
                        </optgroup>
                        <optgroup label="合歡群峰">
                            <option value="38">合歡北峰</option>
                            <option value="55">合歡東峰</option>
                        </optgroup>
                        <optgroup label="奇萊南華">
                            <option value="46">奇萊南峰</option>
                        </optgroup>
                        <optgroup label="嘉明湖步道">
                            <option value="84">向陽山</option>
                            <option value="81">三叉山</option>
                        </optgroup>
                        <optgroup label="玉山主峰">
                            <option value="121">玉山主峰</option>
                        </optgroup>
                        <optgroup label="北大武山">
                            <option value="96">北大武山</option>
                        </optgroup>
                        <optgroup label="南湖群峰">
                            <option value="2">南湖大山</option>
                            <option value="13">南湖東峰</option>
                            <option value="18">南湖北山</option>
                            <option value="20">審馬陣山</option>
                        </optgroup>
                        <optgroup label="大小霸尖山">
                            <option value="101">大霸尖山</option>
                            <option value="7">小霸尖山</option>
                            <option value="112">伊澤山</option>
                            <option value="100">審馬陣山</option>
                        </optgroup>
                        <optgroup label="南橫三星">
                            <option value="92">塔關山</option>
                            <option value="95">關山嶺山</option>
                            <option value="87">庫哈諾辛山</option>
                        </optgroup>
                    </select>
                    <button type="button" onclick=getTable() class="btn btn-outline-success">確定</button>
                </form>

            </div>
            <div class="col-md-12 mt-4 d-flex justify-content-center">
                <h1 id="title"></h1>
            </div>
            <div id="mes" style="text-align: center;">
                <img src="./img/icons8-spinner.gif" alt="" style="height: 50px;"> fetching
            </div>
            <div class="col-md-12">
                <div id="table1" class="tablesticky"></div>
            </div>
            <div class="col-md-12">資料來源:&nbsp;中央氣象局 &nbsp;&nbsp;&nbsp;&nbsp;更新頻率:&nbsp;每6小時</div>
        </div>
    </div>
    <br><br><br><br><br>

    <script>

        $.ajax({
            url: "./weather.php",
            success: function (res) {
                $("#mes").hide()
                var a = JSON.parse(res);
                var b = a.cwbopendata.dataset.locations.location

                // var locname = b[se1].locationName
                // var temp = b[se1].weatherElement[0].time[0].elementValue.value

                // var wd1 = b[0].weatherElement[10].time[0].elementValue.value.split('。')
                // var wd2 = wd1[1].replace("降雨機率","").trim()

                // var wd1 = b[se1].weatherElement[3].time[0].elementValue.value
                // var wd = b[se1].weatherElement[5].time[0].elementValue.value
                // var ws = b[se1].weatherElement[6].time[0].elementValue[0].value
                // var wx = b[se1].weatherElement[9].time[0].elementValue[0].value

                console.log(b)


                getTable = function () {
                    let se1 = document.getElementById("se").value
                    document.getElementById("title").innerHTML = b[se1].locationName

                    let row1 = "<table><thead><tr><td class='t1'>日期</td>"
                    let row2 = "<tbody><tr><td class='t1'>時間</td>"
                    let row3 = "<tr><td class='t1'>溫度</td>"
                    let row4 = "<tr><td class='t1'>降雨機率</td>"
                    let row5 = "<tr><td class='t1'>風向</td>"
                    let row6 = "<tr><td class='t1'>風速</td>"
                    let row7 = "<tr><td rowspan=2 class='t1'>天氣狀況</td>"
                    let row8 = "<tr>"
                    let x = []
                    var date = b[se1].weatherElement[0].time[0].dataTime.toString().substring(0, 10)
                    for (let i = 0; i < 10; i++) {
                        if (b[se1].weatherElement[0].time[i].dataTime.toString().substring(0, 10) === date) {
                            x.push(1)
                        } else {
                            break
                        }
                    }


                    let y = x.length
                    let z = 6 - y

                    row1 += `<td colspan =${y}>` + b[se1].weatherElement[0].time[0].dataTime.toString().substring(0, 10) + "</td>"
                    let row1_2 = "<td colspan=8>" + b[se1].weatherElement[0].time[y].dataTime.toString().substring(0, 10) + "</td>"
                    let row1_3 = "<td colspan=8>" + b[se1].weatherElement[0].time[y + 8].dataTime.toString().substring(0, 10) + "</td>"
                    let row1_4 = "<td colspan=8>" + b[se1].weatherElement[0].time[y + 16].dataTime.toString().substring(0, 10) + "</td>"
                    let row1_5 = `<td colspan =${z}>` + b[se1].weatherElement[0].time[29].dataTime.toString().substring(0, 10) + "</td>"
                    let col = `<colgroup><col span=${y + 1} style='background-color:white;'><col span=8 style='background-color:rgb(201, 238, 252);'>
                               <col span=8 style='background-color:white;'><col span=8 style='background-color:rgb(201, 238, 252);'></colgroup>`



                    for (let i = 0; i < 30; i++) {

                        row2 += "<td>" + b[se1].weatherElement[0].time[i].dataTime.toString().substring(11, 16) + "</td>"
                        row3 += "<td>" + b[se1].weatherElement[0].time[i].elementValue.value + "°C</td>"
                        row5 += "<td>" + b[se1].weatherElement[5].time[i].elementValue.value + "</td>"
                        row6 += "<td>" + b[se1].weatherElement[6].time[i].elementValue[0].value + "<span style='font-size:14px;'>m/s</span></td>"
                        row7 += "<td>" + b[se1].weatherElement[9].time[i].elementValue[0].value + "</td>"


                        var time = b[se1].weatherElement[0].time[i].dataTime.toString().substring(11, 16)
                        var wx2 = b[se1].weatherElement[9].time[i].elementValue[1].value
                        if (time == "00:00" || time == "03:00" || time == "21:00" || time == "18:00") {
                            row8 += "<td>" + `<img src='./img/weathericon/${wx2}00-removebg-preview.png'>` + "</td>"
                        } else {
                            row8 += "<td>" + `<img src='./img/weathericon/${wx2}-removebg-preview.png'>` + "</td>"
                        }
                    }
                    for (let i = 0; i < 15; i++) {
                        row4 += "<td colspan=2>" + b[se1].weatherElement[3].time[i].elementValue.value + "%</td>"
                    }

                    if (z <= 0) {
                        table1 = row1 + row1_2 + row1_3 + row1_4 + "</tr></thead>" + row2 + "</tr>" + row3 + "</tr>" +
                            row4 + row6 + row5 + row7 + row8 + "</tr></tbody>" + col + "</table>"
                    } else {
                        table1 = row1 + row1_2 + row1_3 + row1_4 + row1_5 + "</tr></thead>" + row2 + "</tr>" + row3 + "</tr>" +
                            row4 + row6 + row5 + row7 + row8 + "</tr></tbody>" + col + "</table>"
                    }
                    document.getElementById("table1").innerHTML = table1
                }

                getTable()


            }
        })

    </script>
    <!-- footer -->
    <div class="footer1" id="footer1">
        <div class="container ">
            <div style="height: 30px;"></div>
            <footer class="py-3 my-4 ">
                <ul class="nav justify-content-center border-bottom pb-3 mb-3">
                    <li class="nav-item"><a href="./Home.html" class="nav-link " aria-current="page"
                            style="font-size:20px">Hello Mountain</a></li>
                    <li class="nav-item">
                        <a class="nav-link dropdown-toggle show" href="#" data-bs-toggle="dropdown"
                            aria-expanded="true">熱門百岳路線</a>
                            <ul class="dropdown-menu " data-bs-popper="static">
                                <li class="sub">北部</li>
                                <li><a class="dropdown-item" href="./DaBa_08.html">大小霸尖山</a></li>
                                <li><a class="dropdown-item" href="./NanHu_07.html">南湖群峰</a></li>
                                <li><a class="dropdown-item" href="./MtSylvia_01.html">雪山主東</a></li>
                                <li class="sub">中部</li>
                                <li><a class="dropdown-item" href="./HeHuan_02.html">合歡群峰</a></li>
                                <li><a class="dropdown-item" href="./QilaiNanhua_03.html">奇萊南華</a></li>
                                <li class="sub">南部</li>
                                <li><a class="dropdown-item" href="./MtJade_05.html">玉山主峰</a></li>
                                <li><a class="dropdown-item" href="./NanHeng_09.html">南橫三星</a></li>
                                <li><a class="dropdown-item" href="./BaDaWu_06.html">北大武山</a></li>
                                <li><a class="dropdown-item" href="./JiaMing_04.html">嘉明湖步道</a></li>
                            </ul>
                    </li>
                    <li class="nav-item"><a href="./Allroute.html" class="nav-link">路線一覽</a></li>
                    <li class="nav-item"><a href="./Weather.html" class="nav-link active">天氣預報</a></li>
                    <li class="nav-item"><a href="./Equipment.html" class="nav-link ">裝備清單</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle show" href="#" data-bs-toggle="dropdown"
                            aria-expanded="true">官方網站入口</a>
                        <ul class="dropdown-menu " data-bs-popper="static">
                            <li><a class="dropdown-item" target="_blank" href="https://www.spnp.gov.tw/">雪霸國家公園</a></li>
                            <li><a class="dropdown-item" target="_blank" href="https://www.taroko.gov.tw/">太魯閣國家公園</a>
                            </li>
                            <li><a class="dropdown-item" target="_blank" href="https://www.ysnp.gov.tw/">玉山國家公園</a></li>
                            <li><a class="dropdown-item" target="_blank"
                                    href="https://recreation.forest.gov.tw/">台灣山林悠遊網</a></li>
                        </ul>
                    </li>
                </ul>
            </footer>

        </div>
    </div>
</body>

</html>